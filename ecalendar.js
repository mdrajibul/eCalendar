$(function(){var Calender=function(settings){var defaults={monthLabels:['January','February','March','April','May','June','July','August','September','October','November','December'],weekNames:['S','M','T','W','T','F','S'],minYear:1970,maxYear:2050,container:null,ajaxUrl:null,toolTipData:{},cellClick:function(el,data){}};$.extend(defaults,settings);var clContainer;var tooltipEl;var nextCtl;var previousCtl;var dayContainer;var currDate;var nextDate;var currDay;var currMonth;var currYear;var monthControl;var yearControl;var startingDay;var monthLength;function inObject(value,compareObject){if(compareObject){for(var keys in compareObject){if(value==keys){return true}}return false}return false}function getFormattedDate(date){var currDate=date.getDate();var curMonth=date.getMonth();var currYear=date.getFullYear();return defaults.monthLabels[curMonth]+" "+currDate+", "+currYear}function generateHTML(){clContainer=$("<div/>");clContainer.attr("id","cl-container");clContainer.append(generateHeader());$(defaults.container).empty().append(clContainer);var clBody=$("<div/>");clBody.addClass("cl-body");clBody.append(generateWeekRow());generateDateRow(clBody);clContainer.append(clBody);controlEventBind()}function generateHeader(){var clHeader=$("<div/>");clHeader.addClass("cl-header");var monthTitle=$("<div/>");monthTitle.addClass("cl-monthTitle");monthTitle.text(getFormattedDate(new Date()));clHeader.append(monthTitle);var clControl=$("<div/>");clControl.addClass("cl-controlPanel");monthControl=$("<select/>");monthControl.attr("id","ctl-month");monthControl.attr("name","ctl-month");monthControl.addClass("ctl-select");var monthLengths=defaults.monthLabels.length;for(var i=1;i<=monthLengths;i++){monthControl.append('<option value="'+i+'">'+defaults.monthLabels[i-1]+'</option>')}monthControl.val(currMonth);clControl.append(monthControl);yearControl=$("<select/>");yearControl.attr("id","ctl-year");yearControl.attr("name","ctl-year");yearControl.addClass("ctl-select");for(var i=defaults.minYear;i<=defaults.maxYear;i++){yearControl.append('<option value="'+i+'">'+i+'</option>')}yearControl.val(currYear);clControl.append(yearControl);clHeader.append(clControl);var switchPanel=$("<div/>");switchPanel.addClass("cl-switchPanel");var switchInnerPanel=$("<div/>");switchInnerPanel.addClass("cl-switchInnerPanel");previousCtl=$("<div/>");previousCtl.addClass("ctl-previous");previousCtl.text("Previous");nextCtl=$("<div/>");nextCtl.addClass("ctl-next");nextCtl.text("Next");switchPanel.append(switchInnerPanel);switchInnerPanel.append(previousCtl);switchInnerPanel.append(nextCtl);clHeader.append(switchPanel);return clHeader}function controlEventBind(){nextCtl.bind("click",function(e){var nMonth=parseInt(monthControl.val(),10)+1;if(nMonth>12){nMonth=1}monthControl.val(nMonth);if(nMonth==1){yearControl.val(parseInt(yearControl.val(),10)+1)}var cYear=parseInt(yearControl.val(),10);recalculate(nMonth,cYear)});previousCtl.bind("click",function(e){var pMonth=parseInt(monthControl.val(),10)-1;if(pMonth<1){pMonth=12}monthControl.val(pMonth);if(pMonth==12){yearControl.val(parseInt(yearControl.val(),10)-1)}var cYear=parseInt(yearControl.val(),10);recalculate(pMonth,cYear)});monthControl.bind("change",function(e){var cMonth=parseInt($(this).val(),10);var cYear=parseInt(yearControl.val(),10);recalculate(cMonth,cYear)});yearControl.bind("change",function(e){var cYear=parseInt($(this).val(),10);var cMonth=parseInt(monthControl.val(),10);recalculate(cMonth,cYear)})}function recalculate(pMonth,cYear){initVar(pMonth,cYear);initProperty();if(defaults.ajaxUrl){makeAjaxCall(function(){prepareDateContainer()})}else{generateHTML()}}function getCellWidth(){return Math.round(($(defaults.container).width()/7)-2)}function getCellHeight(){return Math.round(($(defaults.container).height()-($(defaults.container).find(".cl-header").outerHeight()+20))/7)}function generateWeekRow(){var weekTitle=$("<div/>");weekTitle.addClass("cl-weekTitle");var i=0;for(i=0;i<7;i++){var weekCell=$("<div/>");weekCell.addClass("week-cell");weekCell.css({width:getCellWidth(),height:getCellHeight(),'line-height':getCellHeight()+"px"});weekCell.text(defaults.weekNames[i]);if(i==6){weekCell.addClass("bor")}weekTitle.append(weekCell)}return weekTitle}function generateDateRow(clBody){dayContainer=$("<div/>");dayContainer.addClass("cl-dayContainer");clBody.append(dayContainer);prepareDateContainer()}function prepareDateContainer(){dayContainer.empty();var j=1;var loopLength=startingDay>4&&monthLength>30?6:5;var k=1;var m=1;var access=false;for(j;j<=loopLength;j++){var weekNo=$("<div/>");weekNo.addClass("cl-weekNo");var i=1;for(i=1;i<=7;i++){var weekCell=$("<div/>");weekCell.addClass("week-cell");weekCell.css({width:getCellWidth(),height:getCellHeight(),'line-height':getCellHeight()+"px"});if(j==1&&m>=(startingDay+1)){access=true}else if(j>1&&k<=monthLength){access=true}else{access=false}if(access==true){weekCell.text(k);var currentDate=new Date();currDay=currentDate.getDate();if(k==currentDate.getDate()&&currMonth==currDate.getMonth()+1&&currDate.getFullYear()==currYear){weekCell.addClass("active")}var formattedDay;var formattedMonth;if(k<10){formattedDay="0"+k}else{formattedDay=k}if(currMonth<10){formattedMonth="0"+currMonth}else{formattedMonth=currMonth}var presentDay=currYear+"-"+formattedMonth+"-"+formattedDay;weekCell.attr("data-value",presentDay);if(inObject(presentDay,defaults.toolTipData)){weekCell.data('title',defaults.toolTipData[presentDay]);weekCell.addClass('info')}k++}m++;if(i==7){weekCell.addClass("bor")}if(j==loopLength){weekCell.addClass("bob")}weekNo.append(weekCell)}dayContainer.append(weekNo)}setTimeout(cellBind,200)}function cellBind(){clContainer.find(".week-cell").click(function(e){var el=$(this);defaults.cellClick(el,el.attr("data-value"))});clContainer.find(".cl-dayContainer .week-cell").mouseover(function(e){var el=$(this);var title=el.data('title');if(title){if(!tooltipEl){tooltipEl=$("<div />");tooltipEl.addClass("cl-tooltip");$("body").append(tooltipEl)}tooltipEl.show().html(title);var bodyWidth=$("body").width();var posName="left";var pos=e.pageX;if(pos+tooltipEl.outerWidth()>bodyWidth){posName="right";pos=bodyWidth-pos}tooltipEl.removeAttr("style").css("top",e.pageY).css(posName,pos)}});clContainer.find(".cl-dayContainer").mouseout(function(e){if(tooltipEl){tooltipEl.hide()}})}function initVar(month,year){if(currDate==null){currDate=new Date()}currDay=currDate.getDate();currMonth=month||currDate.getMonth()+1;currYear=year||currDate.getFullYear();nextDate=new Date(currYear,currMonth,0)}this.firstDay=null;this.currDate=null;this.currMonth=null;this.currYear=null;this.startingDay=null;this.monthLength=null;this.getFirstDay=function(){return this.firstDay};this.monthLength=function(){return this.monthLength};function initProperty(){this.firstDay=new Date(currYear,currMonth-1,1);this.currDay=currDay;this.currMonth=currMonth;this.currYear=currYear;this.startingDay=this.firstDay.getDay();this.monthLength=nextDate.getDate();startingDay=this.startingDay;monthLength=this.monthLength}function makeAjaxCall(callback){var formattedMonth=currMonth;if(currMonth<10){formattedMonth="0"+currMonth}$.ajax({url:defaults.ajaxUrl,dataType:'json',data:{fromDate:currYear+"-"+formattedMonth+"-01",toDate:currYear+"-"+formattedMonth+"-"+monthLength},success:function(data){defaults.toolTipData=data;if(callback&&$.isFunction(callback)){callback()}else{generateHTML()}}})}function initialize(){initVar();initProperty();if(defaults.ajaxUrl){makeAjaxCall()}else{generateHTML()}}this.init=function(){initialize()};$(window).bind("resize.calender",function(){initialize()});initialize()};$.fn.eCalendar=function(configs){return this.each(function(){if(typeof configs==='object'){configs.container=$(this);return new Calender(configs)}else{$.error('Configuration not found')}})}});